# Java Memory

## Heap

+ Память для создаваемых экземпляров классов
+ Здесь работает сборщик мусора
+ Все объекты обитают в куче и попадают туда при создании
+ Объект состоит из полей класса и методов
+ В куче выделяется место под сам объект - его поля, в соответствии с их размером

## Stack

+ LIFO - Последний зашел - первый вышел
+ Используется для хранения данных при работе методов
+ Все методы обитают в стеке и попадают туда при вызове
+ Переменные в методах так же имеют стековую память, так как они локальные
+ Если в методе создается объект, он помещается в кучу, но его ссылка все еще будет находится
    в стеке и после того как метод покинет стек - объект станет жертвой сборщика мусора,
    так как ссылка на объект потеряна

## Difference between Heap and Stack

+ Куча используется всеми частями приложения а стек только одним потоком
+ Всякий раз, когда создается объект, он всегда помещается в кучу, а ссылка на него
    помещается в стек. Память стека содержит только примитивные локальные переменные и ссылки
    на объекты в куче
+ Объекты в куче могут быть доступны из любой части программы в то время как стековая память
    не может быть доступна для других потоков
+ Управление памятью в стеке осуществляется по схеме LIFO
+ Стековая память существует лишь какое то время работы программы, а память в куче живет
    все время работы
+ Для определения начального и максимального размера кучи используются параметры JVM - Xms, Xmx.
    Размер памяти стека можно определить параметром - Xss
+ Переполнение стека - java.lang.StackOwerflowError, переполнение кучи - java.lang.OutOfMemoryError
+ Размер стековой памяти меньше, работает она быстрее засчет схемы LIFO

## Structure

+ Память Java
    + Стек
    + Куча
        + Статический контекст
        + Куча
            + Новая Куча
                + Первая Куча (Eden)
                + Выжившая Куча (Survival)
            + Старая Куча

+ Описание
    + Eden Space
        + Выделяется память под все создаваемые объекты
        + При заполнении выполняется быстрая очистка сборщиком мусора
    + Survivor Space
        + Сюда перемещаются объекты из Eden, которые пережили хотя бы одну сборку мусора
        + Время от времени объекты из этой кучи перемещаются в Tenured
    + Tenured Generation
        + Здесь скапливаются долгоживущие объекты (синглтоны, менеджеры ресурсов и проч.)
        + При заполнении выполняется полная сборка мусора major, full collection
            которая обрабатывает все объекты в памяти
    + Permanent Generation
        + Здесь хранится метаинформация используемая JVM (классы, методы и т.д.)

## GC

+ Алгоритм
    + С некоторой периодичностью или когда не хватает памяти происходит запуск GC
    + Помечает в куче объекты на которые нет ссылок
    + Перемещает объекты, на которые есть ссылки из первой кучи в выжившую
    + Если объектов с ссылками очень много то компанует их
    + Удаляет объекты без ссылок
    + Если не хватает места в выжившей куче - переносит их в старую кучу

